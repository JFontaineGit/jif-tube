<div class="search-page">
  <!-- Page Header -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        Resultados de búsqueda
      </h1>
      @if (query()) {
        <p class="page-subtitle">
          {{ hasResults() ? songs().length + ' resultados' : 'Sin resultados' }} para "{{ query() }}"
        </p>
      }
    </div>

    <!-- Refresh Button -->
    @if (hasResults()) {
      <button 
        class="reload-btn"
        (click)="refreshSearch()"
        [disabled]="isSearching()"
        [attr.aria-label]="'Recargar búsqueda'">
        <span class="material-icons" [class.spinning]="isSearching()">refresh</span>
      </button>
    }
  </header>

  <!-- Loading State -->
  @if (isSearching()) {
    <div class="loading-state">
      <div class="spinner-wrapper">
        <span class="material-icons spinning">search</span>
        <p>Buscando canciones...</p>
      </div>
    </div>
  }

  <!-- Error Banner -->
  @if (error()) {
    <div class="error-banner" role="alert">
      <span class="material-icons">error_outline</span>
      <div class="error-content">
        <p class="error-message">{{ error() }}</p>
        <button 
          class="retry-btn" 
          (click)="refreshSearch()">
          Reintentar
        </button>
      </div>
      <button 
        class="close-error-btn"
        (click)="clearError()"
        aria-label="Cerrar mensaje de error">
        <span class="material-icons">close</span>
      </button>
    </div>
  }

  <!-- Best Result Section -->
  @if (bestResult() && !isSearching()) {
    <section class="best-result-section">
      <h2 class="section-title">
        <span class="material-icons">star</span>
        Mejor resultado
      </h2>
      
      <div class="best-result">
        <app-song-card
          [song]="bestResult()!"
          [size]="'large'"
          (selected)="playSong(bestResult()!, 0, songs())">
        </app-song-card>
      </div>
    </section>
  }

  <!-- Other Results Section -->
  @if (filteredSongs().length > 0 && !isSearching()) {
    <section class="results-section">
      <h3 class="section-title">
        <span class="material-icons">library_music</span>
        Todas las canciones
      </h3>
      
      <div class="song-list">
        @for (song of filteredSongs(); track trackBySongId($index, song)) {
          <app-song-card
            [song]="song"
            (selected)="playSong(song, $index + 1, songs())">
          </app-song-card>
        }
      </div>
    </section>
  }

  <!-- Empty State -->
  @if (isEmpty()) {
    <div class="empty-state">
      <div class="empty-icon">
        @if (error()) {
          <span class="material-icons">search_off</span>
        } @else {
          <span class="material-icons">music_off</span>
        }
      </div>
      
      <h3>{{ getEmptyStateMessage() }}</h3>
      <p>{{ getEmptyStateSubtitle() }}</p>

      @if (error()) {
        <button class="primary-btn" (click)="refreshSearch()">
          <span class="material-icons">refresh</span>
          Intentar de nuevo
        </button>
      } @else {
        <a href="/search" class="primary-btn">
          <span class="material-icons">search</span>
          Nueva búsqueda
        </a>
      }
    </div>
  }
</div>