<div class="settings-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <span class="material-icons">settings</span>
        Configuración
      </h1>
      <p class="page-subtitle">Personaliza tu experiencia</p>
    </div>
  </header>

  <!-- Success Banner -->
  @if (successMessage()) {
    <div class="success-banner" role="status">
      <span class="material-icons">check_circle</span>
      <span>{{ successMessage() }}</span>
      <button 
        class="close-btn"
        (click)="clearSuccess()"
        aria-label="Cerrar mensaje">
        <span class="material-icons">close</span>
      </button>
    </div>
  }

  <!-- Error Banner -->
  @if (error()) {
    <div class="error-banner" role="alert">
      <span class="material-icons">error_outline</span>
      <span>{{ error() }}</span>
      <button 
        class="close-btn"
        (click)="clearError()"
        aria-label="Cerrar mensaje de error">
        <span class="material-icons">close</span>
      </button>
    </div>
  }

  <div class="settings-container">
    <!-- Sección: Estadísticas -->
    <section class="settings-section stats-section">
      <h2>
        <span class="material-icons">analytics</span>
        Estadísticas
      </h2>

      <div class="stats-grid">
        <div class="stat-card">
          <span class="material-icons">library_music</span>
          <div class="stat-content">
            <span class="stat-value">{{ libraryCount() }}</span>
            <span class="stat-label">Favoritos</span>
          </div>
        </div>

        <div class="stat-card">
          <span class="material-icons">history</span>
          <div class="stat-content">
            <span class="stat-value">{{ historyCount() }}</span>
            <span class="stat-label">Historial</span>
          </div>
        </div>

        <div class="stat-card">
          <span class="material-icons">queue_music</span>
          <div class="stat-content">
            <span class="stat-value">{{ queueCount() }}</span>
            <span class="stat-label">En cola</span>
          </div>
        </div>

        <div class="stat-card">
          <span class="material-icons">storage</span>
          <div class="stat-content">
            <span class="stat-value">{{ getEstimatedStorageUsage() }}</span>
            <span class="stat-label">Almacenamiento</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Sección: Apariencia -->
    <section class="settings-section">
      <h2>
        <span class="material-icons">palette</span>
        Apariencia
      </h2>

      <div class="setting-item info-card">
        <div class="setting-label">
          <span class="material-icons">color_lens</span>
          <div>
            <h3>Tema Dinámico</h3>
            <p>Los colores cambian según la carátula del álbum</p>
          </div>
        </div>
        <span class="badge">Activo</span>
      </div>
    </section>

    <!-- Sección: Reproducción -->
    <section class="settings-section">
      <h2>
        <span class="material-icons">play_circle</span>
        Reproducción
      </h2>

      <!-- Volumen -->
      <div class="setting-item">
        <div class="setting-label">
          <span class="material-icons">
            {{ isMuted() ? 'volume_off' : volume() > 50 ? 'volume_up' : 'volume_down' }}
          </span>
          <div>
            <h3>Volumen</h3>
            <p>{{ isMuted() ? 'Silenciado' : Math.round(volume()) + '%' }}</p>
          </div>
        </div>

        <div class="volume-control">
          <input
            type="range"
            class="volume-slider"
            [value]="volume()"
            (input)="onVolumeChange($event)"
            min="0"
            max="100"
            step="1"
            [disabled]="isMuted()"
            aria-label="Ajustar volumen"
          />
          <button 
            class="icon-btn"
            (click)="toggleMute()"
            [attr.aria-label]="isMuted() ? 'Activar audio' : 'Silenciar audio'">
            <span class="material-icons">
              {{ isMuted() ? 'volume_off' : 'volume_up' }}
            </span>
          </button>
        </div>
      </div>

      <!-- Repeat Mode -->
      <div class="setting-item">
        <div class="setting-label">
          <span class="material-icons">{{ getRepeatIcon() }}</span>
          <div>
            <h3>Modo de repetición</h3>
            <p>{{ getRepeatText() }}</p>
          </div>
        </div>

        <button 
          class="icon-btn"
          (click)="cycleRepeatMode()"
          [class.active]="repeatMode() !== 'off'"
          aria-label="Cambiar modo de repetición">
          <span class="material-icons">{{ getRepeatIcon() }}</span>
        </button>
      </div>

      <!-- Shuffle -->
      <div class="setting-item">
        <div class="setting-label">
          <span class="material-icons">shuffle</span>
          <div>
            <h3>Reproducción aleatoria</h3>
            <p>{{ shuffle() ? 'Activado' : 'Desactivado' }}</p>
          </div>
        </div>

        <button 
          class="icon-btn"
          (click)="toggleShuffle()"
          [class.active]="shuffle()"
          aria-label="Toggle shuffle">
          <span class="material-icons">shuffle</span>
        </button>
      </div>
    </section>

    <!-- Sección: Reproducción Actual -->
    @if (currentSong()) {
      <section class="settings-section">
        <h2>
          <span class="material-icons">music_note</span>
          Reproduciendo ahora
        </h2>

        <div class="setting-item now-playing-card">
          <div class="setting-label">
            <span class="material-icons" [class.playing]="isPlaying()">
              {{ isPlaying() ? 'graphic_eq' : 'pause_circle' }}
            </span>
            <div>
              <h3>{{ currentSong()!.title }}</h3>
              <p>{{ currentSong()!.channel_title || 'Canal desconocido' }}</p>
            </div>
          </div>
        </div>
      </section>
    }

    <!-- Sección: Datos -->
    <section class="settings-section danger-section">
      <h2>
        <span class="material-icons">storage</span>
        Gestión de Datos
      </h2>

      <!-- Exportar -->
      <div class="setting-item">
        <div class="setting-label">
          <span class="material-icons">file_download</span>
          <div>
            <h3>Exportar datos</h3>
            <p>Descarga una copia de tu biblioteca e historial</p>
          </div>
        </div>

        <button 
          class="secondary-button" 
          (click)="exportData()"
          aria-label="Exportar datos">
          <span class="material-icons">download</span>
          Exportar
        </button>
      </div>

      <!-- Importar -->
      <div class="setting-item">
        <div class="setting-label">
          <span class="material-icons">file_upload</span>
          <div>
            <h3>Importar datos</h3>
            <p>Restaura tu biblioteca desde un archivo JSON</p>
          </div>
        </div>

        <button 
          class="secondary-button" 
          (click)="importData()"
          aria-label="Importar datos">
          <span class="material-icons">upload</span>
          Importar
        </button>
      </div>

      <!-- Eliminar todo -->
      <div class="setting-item danger-item">
        <div class="setting-label">
          <span class="material-icons">delete_forever</span>
          <div>
            <h3>Eliminar todos los datos</h3>
            <p>Borra historial, biblioteca y configuraciones. No se puede deshacer.</p>
          </div>
        </div>

        <button 
          class="danger-button" 
          (click)="clearAllData()"
          aria-label="Eliminar todos los datos">
          <span class="material-icons">delete</span>
          Eliminar todo
        </button>
      </div>
    </section>

    <!-- Info Section -->
    <section class="settings-section info-section">
      <h2>
        <span class="material-icons">info</span>
        Información
      </h2>

      <div class="app-info">
        <div class="info-row">
          <span>Versión</span>
          <span class="value">{{ appVersion }}</span>
        </div>
        <div class="info-row">
          <span>Plataforma</span>
          <span class="value">JifTube Music</span>
        </div>
        <div class="info-row">
          <span>Autor</span>
          <span class="value">Just Fontaine</span>
        </div>
        <div class="info-row">
          <span>Framework</span>
          <span class="value">Angular 18 + Signals</span>
        </div>
      </div>
    </section>
  </div>
</div>