@use '../../../styles/_variables.scss' as *;
@use '../../../styles/_mixins.scss' as *;
@use 'sass:math';

$card-width: 220px;
$card-width-tablet: 200px;
$card-width-mobile: 160px;
$play-color: #ef4444;
$hover-scale: 1.03;

.song-card {
  width: $card-width;
  min-height: 280px;
  overflow: hidden;
  position: relative;
  color: var(--text-primary);
  background: transparent;
  border-radius: $border-radius-xl;
  @include card-interactive;  
  @include flex-column;

  @include tablet-only {
    width: $card-width-tablet;
    min-height: 260px;
  }
  
  @include mobile-only {
    width: $card-width-mobile;
    min-height: 220px;
  }
  
  &:hover,
  &:focus-visible {
    transform: scale($hover-scale);
    box-shadow: $shadow-xl;
    border-color: transparent;
    
    .play-overlay {
      opacity: 1;
      backdrop-filter: $blur;
      -webkit-backdrop-filter: $blur;
    }
    
    .thumbnail-image {
      transform: scale(1.08);
    }
    
    .song-info {
      background: transparent;
    }
  }
  
  &:active {
    transform: scale(0.98);
  }
  
  &.official-video {
    .thumbnail {
      @include aspect-ratio(math.div(16, 9));
      
      &::after {
        content: 'OFFICIAL';
        position: absolute;
        top: $spacing-sm;
        left: $spacing-sm;
        background: linear-gradient(135deg, $play-color, #dc2626);
        color: white;
        padding: $spacing-xs $spacing-sm;
        border-radius: $border-radius-sm;
        font-size: $font-size-xs;
        font-weight: $font-weight-bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        z-index: 2;
        box-shadow: $shadow-md;
      }
    }
  }
  
  &.album-track {
    .thumbnail {
      @include aspect-ratio(1);
    }
  }
  
  .thumbnail {
    position: relative;
    width: 100%;
    border-radius: $border-radius-lg $border-radius-lg 0 0;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: transparent;
    overflow: hidden;
    @include aspect-ratio(1);

    .thumbnail-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform $transition-slow;
      border-radius: inherit;
    }
    
    .play-overlay {
      background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.4) 0%,
        rgba(0, 0, 0, 0.7) 100%
      );
      opacity: 0;
      transition: all $transition-normal;
      border-radius: inherit;
      @include absolute-fill;
      @include flex-center;

      .material-icons {
        font-size: 4rem;
        color: $play-color;
        filter: drop-shadow($shadow-lg);
        transition: transform $transition-fast;
        
        @include tablet-only {
          font-size: 3.5rem;
        }
        
        @include mobile-only {
          font-size: 3rem;
        }
        
        &:hover {
          transform: scale(1.1);
        }
      }
    }
  }
  
  .song-info {
    padding: $spacing-lg;
    flex: 1;
    gap: $spacing-sm;
    background: transparent;
    border-radius: 0 0 $border-radius-lg $border-radius-lg;
    transition: background $transition-normal;
    @include flex-column;

    @include tablet-only {
      padding: $spacing-md;
    }
    
    @include mobile-only {
      padding: $spacing-sm $spacing-md;
    }
    
    .song-title {
      font-size: $font-size-lg;
      font-weight: $font-weight-semibold;
      color: var(--text-primary);
      margin: 0;
      line-height: $line-height-tight;
      transition: color $transition-fast;
      @include text-clamp(2);

      @include tablet-only {
        font-size: $font-size-base;
      }
      
      @include mobile-only {
        font-size: $font-size-sm;
      }
      
      &:hover {
        color: var(--dynamic-primary);
      }
    }
    
    .song-artist {
      font-size: $font-size-sm;
      font-weight: $font-weight-normal;
      color: var(--text-secondary);
      margin: 0;
      line-height: $line-height-normal;
      transition: color $transition-fast;
      @include text-truncate;      

      @include mobile-only {
        font-size: $font-size-xs;
      }
      
      &:hover {
        color: var(--text-primary);
      }
    }
  }
  
  // Action buttons (ng-content)
  ::ng-deep button {
    position: absolute;
    top: $spacing-sm;
    right: $spacing-sm;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: $border-radius-full;
    width: 36px;
    height: 36px;
    font-size: $font-size-lg;
    z-index: 2;
    opacity: 0;
    backdrop-filter: $blur-sm;
    -webkit-backdrop-filter: $blur-sm;
    box-shadow: $shadow-md;
    transition: all $transition-normal;
    @include button-base;

    @include mobile-only {
      width: 32px;
      height: 32px;
      font-size: $font-size-base;
    }
    
    &:hover:not(:disabled) {
      background: var(--dynamic-primary);
      transform: scale(1.1);
      box-shadow: $shadow-lg;
    }
  }
  
  &:hover ::ng-deep button {
    opacity: 1;
  }
}

// Loading state
.song-card.loading {
  .thumbnail {
    background: linear-gradient(
      90deg,
      var(--bg-tertiary) 25%,
      var(--bg-secondary) 50%,
      var(--bg-tertiary) 75%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }
  
  .song-title,
  .song-artist {
    background: var(--bg-tertiary);
    color: transparent;
    border-radius: $border-radius-sm;
    animation: shimmer 1.5s infinite;
  }
}

// Accessibility
@media (prefers-reduced-motion: reduce) {
  .song-card {
    transition: box-shadow $transition-normal;
    
    &:hover,
    &:focus-visible {
      transform: none;
    }
    
    .thumbnail-image,
    .play-overlay {
      transition: opacity $transition-normal;
    }
    
    &:hover .thumbnail-image {
      transform: none;
    }
  }
}

// High contrast support
@media (prefers-contrast: high) {
  .song-card {
    border: $border-width-2 solid var(--border-color);
    
    .song-info {
      .song-title {
        font-weight: $font-weight-bold;
      }
    }
    
    .play-overlay {
      background: rgba(0, 0, 0, 0.9);
    }
  }
}