<nav class="navbar" 
     [class.scrolled]="isScrolled" 
     [class.sidebar-collapsed]="sidebarCollapsed"
     role="navigation" 
     aria-label="Main navigation">
  <div class="navbar-container">
    
    <!-- Left section: Hamburger + Brand (mobile) -->
    <div class="navbar-left">
      <!-- Hamburger button (mobile/tablet only) -->
      <button
        class="hamburger-btn"
        (click)="onToggleSidebar()"
        aria-label="Abrir men√∫">
        <span class="material-icons">menu</span>
      </button>

      <!-- Logo (solo en mobile/tablet) -->
      <div class="navbar-brand">
        <h1 class="app-logo">
          <span class="logo-icon">üéµ</span>
          <span>JifTube</span>
        </h1>
      </div>
    </div>

    <!-- Barra de b√∫squeda -->
    <div class="search-container" [class.focused]="isFocused()">
      <form class="search-form" (ngSubmit)="searchSongs()" role="search">
        <div class="search-input-wrapper">
          <button
            type="button"
            class="search-icon-btn"
            aria-label="Search"
            tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>

          <input
            #searchInput
            type="text"
            [value]="searchQuery()"
            (input)="onInput($event)"
            (focus)="onFocus()"
            (blur)="onBlur()"
            (keydown)="onSearchKeydown($event)"
            placeholder="Buscar m√∫sica, soundtracks, covers..."
            class="search-input"
            autocomplete="off" />

          @if (searchQuery()) {
            <button
              type="button"
              class="clear-btn"
              (click)="clearSearch()"
              aria-label="Clear search">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          }

          <button
            type="submit"
            class="search-btn"
            [disabled]="!searchQuery().trim()"
            aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </button>
        </div>
      </form>
    </div>

    <!-- √Årea de acciones de usuario -->
    <div class="navbar-actions">
      @if (currentUser()) {
        <!-- Usuario autenticado -->
        <div class="user-menu-container">
          <button
            type="button"
            class="user-btn"
            (click)="toggleUserMenu()"
            aria-label="User menu"
            [attr.aria-expanded]="isUserMenuOpen()">
            <div class="user-avatar">
              {{ getUserInitials() }}
            </div>
            <svg
              class="chevron-icon"
              [class.rotated]="isUserMenuOpen()"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>

          @if (isUserMenuOpen()) {
            <div class="user-dropdown">
              <div class="dropdown-header">
                <div class="user-avatar-large">
                  {{ getUserInitials() }}
                </div>
                <div class="user-info">
                  <p class="user-name">{{ getUserDisplayName() }}</p>
                  <p class="user-email">{{ currentUser()?.email || '' }}</p>
                </div>
              </div>

              <div class="dropdown-divider"></div>

              <div class="dropdown-menu">
                <button type="button" class="menu-item" (click)="closeUserMenu()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <span>Perfil</span>
                </button>

                <button type="button" class="menu-item" (click)="closeUserMenu()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6"></path>
                  </svg>
                  <span>Configuraci√≥n</span>
                </button>
              </div>

              <div class="dropdown-divider"></div>

              <button type="button" class="menu-item logout-item" (click)="logout()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                <span>Cerrar sesi√≥n</span>
              </button>
            </div>
          }
        </div>
      } @else {
        <!-- No autenticado -->
        <button
          type="button"
          class="login-btn"
          (click)="openAuthDialog()"
          [disabled]="isLoadingUser()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
            <polyline points="10 17 15 12 10 7"></polyline>
            <line x1="15" y1="12" x2="3" y2="12"></line>
          </svg>
          <span>Iniciar sesi√≥n</span>
        </button>
      }
    </div>
  </div>
</nav>

<app-auth-dialog
  [isOpen]="isAuthDialogOpen()"
  (close)="closeAuthDialog()"
  (authSuccess)="onAuthSuccess()">
</app-auth-dialog>