@use '../../../styles/_variables.scss' as var;
@use '../../../styles/_mixins.scss' as mix;
@use '../../../styles/_media-queries.scss' as media;

.app-container {
  position: relative;
  min-height: 100vh;
  width: 100vw;
  background: var.$bg-gradient;
  overflow-x: hidden;
  animation: appLoad 0.6s ease-out;

  &::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var.$bg-glass 45%, transparent) 0%,
      transparent 50%,
      color-mix(in srgb, var.$bg-overlay 65%, rgba(0, 0, 0, 0.08)) 100%
    );
    pointer-events: none;
    z-index: 0;
  }

  .invisible-player {
    @include mix.sr-only;
  }

  // ========================================================================
  // SIDEBAR (full height desde top:0)
  // ========================================================================

  .app-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: var.$z-sidebar;
    height: 100vh;
  }

  // ========================================================================
  // NAVBAR (al lado del sidebar)
  // ========================================================================

  .app-navbar {
    position: fixed;
    top: 0;
    right: 0;
    z-index: var.$z-navbar;
    height: 70px;

    // Desktop: empieza donde termina el sidebar
    @include media.desktop-up {
      left: var.$sidebar-width;

      .sidebar-collapsed ~ & {
        left: 85px;
      }
    }

    // Mobile/Tablet: full width
    @include media.tablet-down {
      left: 0;
      height: 60px;
    }
  }

  // ========================================================================
  // SIDEBAR OVERLAY (mobile/tablet)
  // ========================================================================

  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: calc(var.$z-sidebar - 1);
    cursor: pointer;
    animation: fadeIn 0.2s ease;

    @include media.desktop-up {
      display: none;
    }
  }

  // ========================================================================
  // MAIN CONTENT
  // ========================================================================

  .main-content {
    min-height: 100vh;
    position: relative;
    z-index: 1;
    transition: margin-left var.$transition-normal;

    // Desktop: ajustado al sidebar + navbar + player
    @include media.desktop-up {
      padding-top: 70px;
      padding-bottom: 120px;

      &.sidebar-expanded {
        margin-left: var.$sidebar-width;
      }

      &.sidebar-collapsed {
        margin-left: 85px;
      }
    }

    // Mobile/Tablet: sin margen del sidebar
    @include media.tablet-down {
      margin-left: 0;
      padding-top: 60px;
      padding-bottom: 150px;
    }

    .content-wrapper {
      padding: var.$spacing-2xl;
      max-width: 1400px;
      margin: 0 auto;

      @include media.tablet-only {
        padding: var.$spacing-xl;
      }

      @include media.mobile-only {
        padding: var.$spacing-lg var.$spacing-md;
      }

      @include mix.custom-scrollbar;
    }
  }

  // ========================================================================
  // PLAYER (fixed bottom, ajustado al sidebar)
  // ========================================================================

  .app-player {
    position: fixed;
    bottom: 0;
    right: 0;
    z-index: var.$z-player;
    transition: left var.$transition-normal;

    // Desktop: ajustado al sidebar
    @include media.desktop-up {
      left: var.$sidebar-width;

      .sidebar-collapsed ~ & {
        left: 85px;
      }
    }

    // Mobile/Tablet: full width
    @include media.tablet-down {
      left: 0;
    }
  }
}

// ============================================================================
// ANIMATIONS
// ============================================================================

@keyframes appLoad {
  from {
    opacity: 0;
    transform: scale(0.98);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

// ============================================================================
// ACCESSIBILITY
// ============================================================================

@include media.reduce-motion {
  .app-container {
    animation: none !important;
    
    * {
      animation: none !important;
      transition: none !important;
    }
  }
}

@include media.high-contrast {
  .app-container {
    background: #000000;

    &::before {
      display: none;
    }

    .main-content,
    .app-sidebar,
    .app-navbar,
    .app-player {
      border: 2px solid #ffffff;
    }
  }
}

// ============================================================================
// PRINT STYLES
// ============================================================================

@media print {
  .app-container {
    .app-navbar,
    .app-sidebar,
    .app-player,
    .sidebar-overlay {
      display: none !important;
    }

    .main-content {
      margin: 0;
      padding: 0;
    }
  }
}